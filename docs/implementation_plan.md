# Splat Replay - 実装計画書

**文書バージョン:** 2025-05-25
**文書管理者:** LLM（ドラフト作成）・ユーザー（オーナー／レビュワー）

---

## 関連文書

- [外部設計書](./spec_external.md) - ユーザー向け機能仕様と操作フロー
- [内部設計書](./spec_internal.md) - アーキテクチャとモジュール設計

---

## 1. 目的

この計画書は、大規模な「Splat Replay」アプリを LLM が把握しやすい単位に分割し、**最小実用プロダクト（MVP）** から実装を始めるための指針です。各マイルストーンでユーザーが動作を確認しフィードバックを返し、段階的に機能を拡張していきます。

---

## 2. 開発環境前提条件

### 実行環境

- **OS**: Windows 11
- **シェル**: PowerShell
- **Python バージョン管理**: uv（Python 仮想環境管理）

### uv コマンド例

```powershell
# プロジェクトの初期化（既存の場合はスキップ）
uv init

# 仮想環境の作成
uv venv

# 仮想環境の有効化
.\.venv\Scripts\activate

# 依存関係のインストール
uv sync

# パッケージの追加インストール
uv add <package_name>

# パッケージの削除
uv remove <package_name>
```

---

## 3. 役割と責任

| アクター          | 役割                                                                                                                                                                                                                     |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **LLM（あなた）** | • 各マイルストーンのコード・テスト・ドキュメントを実装する。• ドメイン固有情報が不足している場合はユーザーに確認する。• レトロスペクティブでリファクタや計画変更を提案する。• 本計画書を随時更新し、承認履歴を記録する。 |
| **ユーザー**      | • 提供コードを実行して動作を検証する。• フィードバックとドメイン知識を提供する。• 各マイルストーンの完了を正式に承認する。                                                                                               |

---

## 4. MVP の定義

MVP では **1 試合分の自動録画ループ** をエンドツーエンドで実装します（UI は最小限）。

1. **録画制御**: ダミー画像トリガーで「試合開始」を検知し、OBS を通じて録画開始／停止（ポーズは未対応）。
2. **状態マシン**: Standby → Recording → Post-Process → Standby へ遷移し、構造化ログを出力。
3. **CLI インターフェース**のみ。
4. **ポストプロセス**: FFmpeg で動画クリップを結合し、メタデータのプレースホルダを埋め込む。
5. **設定 & ロギング**: `.toml` / `.yaml` で設定、JSON 形式の構造化ログ。

> **MVP の非目標**: OCR 精度向上・字幕生成・GUI メタデータ編集・YouTube アップロード・サーモンラン対応 など。

---

## 5. マイルストーンロードマップ

| ID      | 名称                          | 目的と主要タスク                                                                           | 成果物                                         | 承認基準                                                                     |
| ------- | ----------------------------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------- | ---------------------------------------------------------------------------- |
| **M0**  | プロジェクトブートストラップ  | チームが共通の開発基盤で作業を開始できるよう、リポジトリ構成と基本ドキュメントを整備する。 | 初期リポジトリ・README・基本動作確認スクリプト | ユーザーがセットアップ手順どおりに環境を構築し、ヘルプコマンドが実行できる。 |
| **M1**  | コアドメイン & 録画機能       | 1 試合を手動で録画できる最小限の CLI を完成させ、アプリの中心となる状態管理を確立する。    | `record-demo` コマンドとログファイル           | 録画テストで 10 秒の動画が生成され、ログに状態遷移が記録される。             |
| **M2**  | 自動開始／停止検知            | ゲーム画面の変化を検知して録画を自動的に開始・終了できるようにする。                       | `watch` コマンド                               | トリガー画像の表示／非表示で自動録画が機能する。                             |
| **M3**  | ポストプロセスパイプライン    | 録画後に動画を整形し、後工程で活用できるメタデータを付与する。                             | 結合済み MP4・メタデータファイル               | 生成ファイルをユーザーが再生・確認できる。                                   |
| **M4**  | MVP レビュー & 計画調整       | これまでの成果を振り返り、次フェーズに向けた改善点と計画を確定する。                       | レトロスペクティブ報告・更新版ロードマップ     | ユーザーが改善提案を承認し、次フェーズへ進む。                               |
| **M5**  | メタデータ抽出                | バトルのルール・ステージ・勝敗など、学習に役立つ情報を自動取得できるようにする。           | メタデータ抽出モジュール・テスト               | 抽出結果をユーザーが確認し、正確性に納得する。                               |
| **M6**  | 字幕生成 & 埋込               | 音声を文字起こしし、視聴体験向上と検索性向上を図る。                                       | 字幕付き動画ファイル                           | 字幕が動画に正しく同期している。                                             |
| **M7**  | GUI 基盤                      | 直感的に操作できる基礎 UI を用意し、主要ステータスを可視化する。                           | プレビュー付きメインウィンドウ                 | GUI が起動し、映像と録画インジケータが表示される。                           |
| **M8**  | GUI 編集機能                  | メタデータの手動編集や録画管理を GUI から行えるようにする。                                | 完全動作するメタデータパネル                   | GUI 操作で変更した内容が保存される。                                         |
| **M9**  | 自動アップロード              | 完成した動画をワンステップで共有できる導線を整備する。                                     | YouTube へのアップロード機能                   | アップロード完了をユーザーが確認できる。                                     |
| **M10** | 電源管理 & 接続チェック       | ハードウェア接続の確認と省電力運用を自動化する。                                           | 接続チェック警告・自動スリープ復帰             | 非接続時に警告が表示され、アップロード後に PC が安全にスリープする。         |
| **M11** | パフォーマンス改善 & 設定管理 | 動作速度とユーザー設定の柔軟性を高める。                                                   | 解析スピード改善・設定管理画面                 | 処理時間と設定反映をユーザーが確認できる。                                   |
| **M12** | リリース候補 & ドキュメント   | 安定版公開に向け、配布形態とユーザーガイドを整備する。                                     | インストーラ・ユーザーマニュアル               | 新規環境で導入し全機能が動作することをユーザーが確認。                       |

---

## 6. イテレーションプロセス

1. **実装**: LLM が現在のマイルストーンのコード／テストを作成。
2. **成果物提示**: LLM が実行手順を示し、本章 §7 にドメイン知識質問を追加。
3. **検証**: ユーザーが動作確認し、結果報告・情報提供。
4. **承認**: ユーザーが「M# OK」とコメントしたら、本章 §9 に記録し次へ。
5. **レトロスペクティブ**: マイルストーン境界で LLM が振り返りをまとめ、必要に応じ設計／計画を更新。

---

## 7. 品質と開発ポリシー

- コードとドキュメントは **わかりやすさと保守性** を最優先にする。
- 変更ごとに **自動テスト** を追加し、主要機能の動作を保証する。
- バージョン管理とレビューを通じて **継続的な品質向上** を図る。

---

## 8. 保留中のドメイン知識要求

| 日付 | 必要なトピック | 影響マイルストーン | 状態 |
| ---- | -------------- | ------------------ | ---- |
|      |                |                    |      |

質問が生じたら LLM がここに追記します（例: ステージ名一覧など）。

---

## 9. マイルストーンサインオフ記録

| マイルストーン | 承認日     | 承認者   | メモ            |
| -------------- | ---------- | -------- | --------------- |
| M0             | 2025-05-26 | ユーザー | M0 完了を承認。 |
| M1             | —          |          |                 |
| M2             | —          |          |                 |
| M3             | —          |          |                 |
| M4             | —          |          |                 |
| M5             | —          |          |                 |
| M6             | —          |          |                 |
| M7             | —          |          |                 |
| M8             | —          |          |                 |
| M9             | —          |          |                 |
| M10            | —          |          |                 |
| M11            | —          |          |                 |
| M12            | —          |          |                 |

---

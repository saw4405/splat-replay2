# Splat Replay - 開発計画書

## 1. 目的

この計画書は、大規模な「Splat Replay」アプリを LLM が把握しやすい単位に分割し、実装を始めるための指針です。各マイルストーンでユーザーが動作を確認しフィードバックを返し、段階的に機能を拡張していきます。

---

## 2. 開発環境前提条件

### 実行環境

- **OS**: Windows 11
- **シェル**: PowerShell
- **Python バージョン管理**: uv（Python 仮想環境管理）

---

## 3. 役割と責任

| アクター          | 役割                                                                                                                                                                                                                     |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **LLM（あなた）** | • 各マイルストーンのコード・テスト・ドキュメントを実装する。• ドメイン固有情報が不足している場合はユーザーに確認する。• レトロスペクティブでリファクタや計画変更を提案する。• 本計画書を随時更新し、承認履歴を記録する。 |
| **ユーザー**      | • 提供コードを実行して動作を検証する。• フィードバックとドメイン知識を提供する。• 各マイルストーンの完了を正式に承認する。                                                                                               |

---

## 4. マイルストーンロードマップ

| ID      | 名称                          | 目的と主要タスク                                                                           | 成果物                                         | 承認基準                                                                     |
| ------- | ----------------------------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------- | ---------------------------------------------------------------------------- |
| **M0**  | プロジェクトブートストラップ  | チームが共通の開発基盤で作業を開始できるよう、リポジトリ構成と基本ドキュメントを整備する。 | 初期リポジトリ・README・基本動作確認スクリプト | ユーザーがセットアップ手順どおりに環境を構築し、ヘルプコマンドが実行できる。 |
| **M1**  | コアドメインモデル            | ドメインエンティティと状態管理の基盤を確立する。                                           | Match, VideoClip, StateMachine 実装とテスト    | pytest が全てパスし、状態遷移ログが出力される。                              |
| **M2**  | 基本録画機能                  | OBS 連携による手動録画機能を実装する。                                                     | `record-demo` コマンド                         | 10 秒の録画ファイルが生成され、開始・停止が確認できる。                      |
| **M3**  | 画像解析基盤                  | 複数の画像マッチング手法を実装し、基本的な画面検知を可能にする。                           | 画像マッチング機能とテスト画像                 | テスト画像で各マッチング手法が正しく動作する。                               |
| **M4**  | バトル検知ロジック            | ゲーム画面のバトル開始・終了を検知する具体的なロジックを実装する。                         | `watch` コマンド                               | トリガー画像の表示／非表示で自動録画が機能する。                             |
| **M5**  | ポストプロセスパイプライン    | 録画後に動画を整形し、後工程で活用できるメタデータを付与する。                             | 結合済み MP4・メタデータファイル               | 生成ファイルをユーザーが再生・確認できる。                                   |
| **M6**  | MVP レビュー & 計画調整       | これまでの成果を振り返り、次フェーズに向けた改善点と計画を確定する。                       | レトロスペクティブ報告・更新版ロードマップ     | ユーザーが改善提案を承認し、次フェーズへ進む。                               |
| **M7**  | メタデータ抽出                | バトルのルール・ステージ・勝敗など、学習に役立つ情報を自動取得できるようにする。           | メタデータ抽出モジュール・テスト               | 抽出結果をユーザーが確認し、正確性に納得する。                               |
| **M8**  | 字幕生成 & 埋込               | 音声を文字起こしし、視聴体験向上と検索性向上を図る。                                       | 字幕付き動画ファイル                           | 字幕が動画に正しく同期している。                                             |
| **M9**  | GUI 基盤                      | 直感的に操作できる基礎 UI を用意し、主要ステータスを可視化する。                           | プレビュー付きメインウィンドウ                 | GUI が起動し、映像と録画インジケータが表示される。                           |
| **M10** | GUI 編集機能                  | メタデータの手動編集や録画管理を GUI から行えるようにする。                                | 完全動作するメタデータパネル                   | GUI 操作で変更した内容が保存される。                                         |
| **M11** | 自動アップロード              | 完成した動画をワンステップで共有できる導線を整備する。                                     | YouTube へのアップロード機能                   | アップロード完了をユーザーが確認できる。                                     |
| **M12** | 電源管理 & 接続チェック       | ハードウェア接続の確認と省電力運用を自動化する。                                           | 接続チェック警告・自動スリープ復帰             | 非接続時に警告が表示され、アップロード後に PC が安全にスリープする。         |
| **M13** | パフォーマンス改善 & 設定管理 | 動作速度とユーザー設定の柔軟性を高める。                                                   | 解析スピード改善・設定管理画面                 | 処理時間と設定反映をユーザーが確認できる。                                   |
| **M14** | リリース候補 & ドキュメント   | 安定版公開に向け、配布形態とユーザーガイドを整備する。                                     | インストーラ・ユーザーマニュアル               | 新規環境で導入し全機能が動作することをユーザーが確認。                       |

---

## 5. イテレーションプロセス

1. **指示**: ユーザーが作業指示書をもとに LLM に作業指示。
2. **実装**: LLM が現在のマイルストーンのコード／テストを作成。
3. **成果物提示**: LLM が実行手順を示す。
4. **検証**: ユーザーが動作確認し、結果報告・情報提供。
5. **承認**: ユーザーが「M# OK」とコメントしたら、本章 §8 に記録し次へ。
6. **レトロスペクティブ**: マイルストーン境界で LLM が振り返りをまとめ、必要に応じ設計／計画を更新。

---

## 6. 品質と開発ポリシー

- コードとドキュメントは **わかりやすさと保守性** を最優先にする。
- 変更ごとに **自動テスト** を追加し、主要機能の動作を保証する。
- バージョン管理とレビューを通じて **継続的な品質向上** を図る。

---

## 7. 作業指示書テンプレート

> **⚠️ 使用方法**
>
> 1. このテンプレートを **`.github/prompts/MX.prompt.md`** にコピーしてから編集する。
> 2. `<...>` のプレースホルダーを置き換える。
> 3. 不要な節・項目は削除してかまわない。
> 4. タスクの粒度は “1 人日以内” が目安。

---

### 1. ドキュメント概要

| 項目           | 入力例          |
| -------------- | --------------- |
| マイルストーン | M2 基本録画機能 |
| 作成日         | 2025-05-31      |
| 作成者         | LLM             |
| レビュワー     | ユーザー        |

---

### 2. マイルストーンの内容（要約）

外部設計書・内部設計書・開発計画書の **該当マイルストーン節** を読み、以下を箇条書きで整理する。

- **目的／背景**
- **期待するユーザー価値**
- **主要機能**
- **前提条件／制約**

---

### 3. 作業の概要

実装対象ユースケース、主要クラス／関数、追加される CLI・GUI コマンド、参照する OSS などを簡潔に列挙する。

---

### 4. 作業範囲

- **コード**: `src/<layer>/...`
- **テスト**: `tests/<layer>/...`
- **設定**: `config/**/*.toml`, `config/**/*.yaml`
- **ドキュメント**: `docs/**`（必要に応じて）

---

### 5. 作業目標と品質基準

| カテゴリ           | 基準例                                      |
| ------------------ | ------------------------------------------- |
| **テスト**         | pytest Green                                |
| **静的解析**       | `ruff check .` 警告 0、`mypy --strict` エラー 0   |
| **動作確認**       | 仕様どおり CLI/GUI が動作し、エラーが出ない |
| **パフォーマンス** | 基準 FPS / 処理時間 ×0.9 以内（必要時）     |
| **ドキュメント**   | README、CHANGELOG、開発計画書を最新化       |

---

### 6. 詳細タスク

> タスクは「### MX-NN <タスク名>」の見出しで定義する。
> **対象範囲 / 目的 / 完成度 / 手順 / 対象外 / 完了条件** を必ず記載。

#### MX-01 <タスク名>

- **対象範囲**: `<コードパス・モジュール>`
- **目的**: `<なぜ行うか>`
- **完成度**: `<プロトタイプ / MVP / 本番品質>`
- **手順**:

  1. `<手順1>`
  2. `<手順2>`

- **対象外**: `<今回扱わない内容>`
- **完了条件**: `<テスト・レビューポイントなど>`

> ```powershell
> # 例: 依存追加
> uv add opencv-python==4.11.0
> ```

_(MX-02, MX-03 … を必要数追加)_

---

### 7. 作業前チェック

> `.github/prompts/common.prompt.md` の **作業前チェック** を実施し、全項目を満たしているか確認すること。

---

### 8. 作業完了チェックリスト（次マイルストーンへのインプット）

| ✔    | 項目                            | 記載内容 |
| ---- | ------------------------------- | -------- |
| \[ ] | **実装機能サマリ**              |          |
| \[ ] | **既存機能への影響**            |          |
| \[ ] | **主要変更点 (LoC/ファイル数)** |          |
| \[ ] | **追加依存ライブラリ**          |          |
| \[ ] | **テスト結果・カバレッジ**      |          |
| \[ ] | **パフォーマンス測定**          |          |
| \[ ] | **ドキュメント更新箇所**        |          |
| \[ ] | **既知の課題 / TODO**           |          |
| \[ ] | **次マイルストーンへの提案**    |          |
| \[ ] | **リリースノート更新**          |          |
| \[ ] | **レビュワーサインオフ**        |          |

> 完了後、表の空欄を埋めてる。

---

### 9. 参考資料

| 資料           | パス / URL                         |
| -------------- | ---------------------------------- |
| 外部設計書     | `docs/external_spec.md`            |
| 内部設計書     | `docs/internal_design.md`          |
| 開発計画書     | `docs/development_plan.md`         |
| 共通作業指示書 | `.github/prompts/common.prompt.md` |

---

## 8. マイルストーンサインオフ記録

| マイルストーン | 承認日 | 承認者 | メモ |
| -------------- | ------ | ------ | ---- |
| M0             | —      |        |      |
| M1             | —      |        |      |
| M2             | —      |        |      |
| M3             | —      |        |      |
| M4             | —      |        |      |
| M5             | —      |        |      |
| M6             | —      |        |      |
| M7             | —      |        |      |
| M8             | —      |        |      |
| M9             | —      |        |      |
| M10            | —      |        |      |
| M11            | —      |        |      |
| M12            | —      |        |      |
| M13            | —      |        |      |
| M14            | —      |        |      |

---
